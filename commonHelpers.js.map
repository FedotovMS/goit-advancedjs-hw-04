{"version":3,"file":"commonHelpers.js","sources":["../src/js/service-api.js","../src/js/markup.js","../src/js/iziToast.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\nexport const per_page = 40;\n\nexport async function fetchImages(searchQuery, page) {\n  const BASE_URL = 'https://pixabay.com/api/';\n  const API_KEY = '34617221-40fb3a679d52688cd42ce20c8';\n\n  const options = new URLSearchParams({\n    key: API_KEY,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: 'true',\n    q: searchQuery,\n    page,\n    per_page,\n  });\n\n  const { data } = await axios.get(`${BASE_URL}?${options}`);\n  return data;\n}\n","export default function createMarkup(arr) {\n  return arr\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) =>\n        `\n      <div class=\"photo-card\">\n      <a href=\"${largeImageURL}\" class=\"image-link\">\n       <img src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" class=\"image\"/>\n      </a\n      <div class=\"info\">\n          <p class=\"info-item\">\n              <b>Likes: ${likes}</b>\n          </p>\n              <p class=\"info-item\">\n          <b>Views: ${views}</b>\n          </p>\n          <p class=\"info-item\">\n              <b>Comments: ${comments}</b>\n          </p>\n          <p class=\"info-item\">\n              <b>Downloads: ${downloads}</b>\n          </p>\n      </div>\n  </div>`\n    )\n    .join('');\n}\n","import iziToast from 'izitoast';\n\nconst options = {\n  timeout: 3000,\n  close: false,\n  closeOnClick: true,\n  icon: null,\n  position: 'topLeft',\n};\n\nexport default class Messages {\n  static success(message) {\n    iziToast.success({\n      title: 'Success',\n      titleColor: 'green',\n      message: message,\n      messageColor: 'green',\n      progressBarColor: 'green',\n      ...options,\n    });\n  }\n  static error(message) {\n    iziToast.error({\n      title: 'Error',\n      titleColor: 'red',\n      message: message,\n      messageColor: 'red',\n      progressBarColor: 'red',\n      ...options,\n    });\n  }\n  static warning(message) {\n    iziToast.warning({\n      title: 'Warning',\n      message: message,\n      titleColor: 'red',\n      messageColor: 'red',\n      progressBarColor: 'red',\n      ...options,\n    });\n  }\n}\n","import SimpleLightbox from 'simplelightbox';\nimport { fetchImages, per_page } from './js/service-api.js';\nimport renderMarkup from './js/markup.js';\nimport Messages from './js/iziToast.js';\n\nimport 'izitoast/dist/css/iziToast.min.css';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst form = document.querySelector('.search-form');\nconst gallery = document.querySelector('.gallery');\n\nlet page = 1;\nlet searchQuery = '';\nlet totalHits = 0;\nlet totalPages = 1;\n\nconst options = {\n  rootMargin: '200px',\n  threshold: 0.1,\n};\n\nconst modal = new SimpleLightbox('.gallery a', {});\n\nfunction onEntry(items, observer) {\n  items.forEach(async item => {\n    if (item.isIntersecting) {\n      observer.unobserve(item.target);\n      await renderGallery();\n    }\n  });\n}\n\nconst observer = new IntersectionObserver(onEntry, options);\n\nasync function onSubmit(e) {\n  e.preventDefault();\n\n  const searchQueryValue = e.target.elements.searchQuery.value.trim();\n\n  if (searchQueryValue === '') {\n    return Messages.error('Please enter a search query!');\n  }\n  if (searchQueryValue === searchQuery) {\n    return Messages.warning('Please enter a new search query! Or scroll down');\n  }\n  await renderGallery();\n}\n\nfunction pageHandler() {\n  const newQuery = form.elements.searchQuery.value.trim();\n\n  if (newQuery !== searchQuery) {\n    page = 1;\n    totalPages = 1;\n    searchQuery = newQuery;\n    return true;\n  }\n  page += 1;\n  return false;\n}\n\nasync function renderGallery() {\n  const isQuery = pageHandler();\n\n  if (isQuery) {\n    gallery.innerHTML = '';\n  }\n\n  if (page > totalPages) {\n    Messages.warning(\n      'We are sorry, but you have reached the end of search results'\n    );\n    return;\n  }\n\n  let hits;\n\n  try {\n    const data = await fetchImages(searchQuery, page);\n    hits = data.hits;\n    totalHits = data.totalHits;\n    totalPages = Math.ceil(totalHits / per_page);\n  } catch (error) {\n    Messages.error(error.message);\n  }\n\n  if (!hits.length) {\n    Messages.error(\n      'Sorry, there are no images matching your search query. Please try again.'\n    );\n    return;\n  }\n  if (isQuery) {\n    const massage = `\"Hooray! We found ${totalHits} images.\"`;\n    Messages.success(massage);\n  }\n\n  gallery.insertAdjacentHTML('beforeend', renderMarkup(hits));\n  observer.observe(gallery.lastElementChild);\n  modal.refresh();\n}\n\nform.addEventListener('submit', onSubmit);\n\nlet debounceTimer;\n\nwindow.addEventListener('scroll', async () => {\n  clearTimeout(debounceTimer);\n\n  debounceTimer = setTimeout(async () => {\n    const distanceToBottom =\n      document.documentElement.offsetHeight -\n      (window.scrollY + window.innerHeight);\n\n    const threshold = 10;\n\n    if (distanceToBottom < threshold) {\n      const lastPage = page;\n      await renderGallery();\n\n      if (lastPage === page) {\n        Messages.warning(\n          'We are sorry, but you have reached the end of search results'\n        );\n\n        window.removeEventListener('scroll');\n      }\n    }\n  }, 100);\n});\n"],"names":["per_page","fetchImages","searchQuery","page","BASE_URL","API_KEY","options","data","axios","createMarkup","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads","Messages","message","iziToast","form","gallery","totalHits","totalPages","modal","SimpleLightbox","onEntry","items","observer","item","renderGallery","onSubmit","e","searchQueryValue","pageHandler","newQuery","isQuery","hits","error","massage","renderMarkup","debounceTimer","lastPage"],"mappings":"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"}